<div class="mb-6">
  <a href="/jobs/<%= @run.job_id %>" class="text-sm text-slate-500 hover:text-slate-700">Back to job</a>
  <span class="text-slate-400 mx-2">Â·</span>
  <a href="/runs" class="text-sm text-slate-500 hover:text-slate-700">Back to runs</a>
</div>

<div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-6">
  <h1 class="text-2xl font-bold text-slate-900">Run #<%= @run.id %></h1>
  <p class="mt-1 text-sm text-slate-500">Job: <code class="px-2 py-0.5 bg-slate-100 rounded font-mono text-xs"><%= @run.job_id %></code></p>

  <div class="mt-4 flex items-center gap-3 flex-wrap">
    <span class="text-sm font-medium text-slate-700">Status:</span>
    <% status_class = case @run.status
       when 'queued' then 'bg-indigo-100 text-indigo-800'
       when 'running' then 'bg-amber-100 text-amber-800'
       when 'succeeded' then 'bg-emerald-100 text-emerald-800'
       when 'failed' then 'bg-red-100 text-red-800'
       when 'cancelled' then 'bg-slate-100 text-slate-600'
       else 'bg-slate-100 text-slate-600'
       end %>
    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium <%= status_class %>"><%= @run.status %></span>
    <% if %w[queued running].include?(@run.status) %>
      <form method="post" action="/runs/<%= @run.id %>/cancel" class="inline">
        <button type="submit" class="inline-flex items-center px-3 py-1.5 border border-red-300 text-sm font-medium rounded-lg text-red-700 bg-white hover:bg-red-50">Cancel</button>
      </form>
    <% end %>
    <% if %w[succeeded failed cancelled].include?(@run.status) %>
      <form method="post" action="/runs/<%= @run.id %>/rerun" class="inline">
        <button type="submit" class="inline-flex items-center px-3 py-1.5 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700">Rerun</button>
      </form>
    <% end %>
    <% if @run.cancel_requested %>
      <span class="text-sm text-slate-500">cancel_requested</span>
    <% end %>
  </div>
</div>

<div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mb-6">
  <h2 class="text-lg font-semibold text-slate-900 px-6 py-4 border-b border-slate-200">Hosts</h2>
  <table class="min-w-full divide-y divide-slate-200">
    <thead class="bg-slate-50">
      <tr>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Host</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Status</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Error</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-slate-200">
      <% @host_results.each do |h| %>
        <tr>
          <td class="px-6 py-4 text-sm font-mono text-slate-800"><%= h.host_name %></td>
          <td class="px-6 py-4 whitespace-nowrap">
            <% h_status_class = case h.status
               when 'success', 'succeeded' then 'bg-emerald-100 text-emerald-800'
               when 'failed' then 'bg-red-100 text-red-800'
               when 'changed' then 'bg-amber-100 text-amber-800'
               else 'bg-slate-100 text-slate-600'
               end %>
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= h_status_class %>"><%= h.status %></span>
          </td>
          <td class="px-6 py-4 text-sm text-slate-500"><%= h.error %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
  <h2 class="text-lg font-semibold text-slate-900 px-6 py-4 border-b border-slate-200">Output (text)</h2>
  <pre class="p-6 text-sm font-mono text-slate-100 bg-slate-900 overflow-x-auto whitespace-pre-wrap break-words"><%= @run.text_output %></pre>
</div>
